# MARUmer
# Пайплайн анализа нулломеров с графом де Брюйна

Комплексный инструментарий для поиска и анализа нулломеров (отсутствующих k-меров) в бактериальных геномах с построением и анализом графа де Брюйна.

## Обзор

Этот пайплайн реализует методологию для:
- Эффективного подсчета k-меров в больших наборах геномов
- Идентификации нулломеров (k-меров, отсутствующих во всех геномах)
- Построения графа де Брюйна из наблюдаемых k-меров
- Анализа контекста нулломеров в структуре графа
- Классификации нулломеров по их связности
- Визуализации результатов и статистического анализа

## Требования

### Системные требования
- Linux/Unix система
- C++17 совместимый компилятор (g++ 7.0+)
- Python 3.7+
- Минимум 16 GB RAM (рекомендуется 32 GB для больших датасетов)
- OpenMP для параллелизации

### Зависимости
```bash
# Системные пакеты
sudo apt-get install build-essential g++ python3-pip

# Python пакеты
pip install numpy pandas matplotlib seaborn scipy scikit-learn networkx tqdm

# Опционально для Jellyfish метода
sudo apt-get install jellyfish
```

## Установка

```bash
# Клонирование репозитория
git clone <repository_url>
cd nullomer_pipeline

# Компиляция
make all

# Установка Python зависимостей
make install-deps

# Проверка установки
make test
```

## Использование

### Быстрый старт

```bash
# Базовый запуск с C++ анализатором
./run_nullomer_pipeline.sh -d /path/to/genomes

# С указанием метода и параметров
./run_nullomer_pipeline.sh -d /path/to/genomes -k 13 -t 16 -m cpp
```

### Параметры командной строки

```
-d, --dir PATH         Директория с геномами (обязательно)
-m, --method METHOD    Метод анализа: cpp (default), jellyfish, aindex
-k, --kmer SIZE        Размер k-мера (по умолчанию: 13)
-t, --threads N        Количество потоков (по умолчанию: все доступные)
-o, --output DIR       Выходная директория (по умолчанию: nullomer_analysis_results)
--max-genomes N        Максимальное количество геномов для анализа
--skip-build           Пропустить компиляцию программ
```

### Прямое использование компонентов

#### 1. Анализатор с графом де Брюйна
```bash
./bin/nullomer_debruijn_analyzer /path/to/genomes \
    --threads 16 \
    --output debruijn_analysis.txt \
    --max-genomes 1000
```

#### 2. Оптимизированный базовый анализатор
```bash
./bin/nullomer_analyzer_optimized /path/to/genomes \
    --k 13 \
    --threads 16 \
    --output results.csv
```

#### 3. Поиск core нулломеров
```bash
./bin/core_nullomer_finder results.csv \
    --k 13 \
    --threshold 0.95 \
    --output core_nullomers.txt
```

### Методы анализа

#### 1. C++ метод (рекомендуется)
- Самый быстрый и эффективный по памяти
- Использует SIMD оптимизации
- Строит граф де Брюйна напрямую
- Подходит для больших датасетов

#### 2. Jellyfish метод
- Использует проверенный инструмент Jellyfish
- Требует создания промежуточного mega.fasta файла
- Хорош для сравнения результатов
- Может потребовать больше дискового пространства

#### 3. AIndex метод
- Эффективен для работы с множеством файлов
- Создает компактный индекс
- Поддерживает инкрементальное обновление

## Выходные данные

### Структура выходной директории
```
nullomer_analysis_results/
├── debruijn_analysis.txt          # Основные результаты анализа
├── summary_report.txt             # Сводный отчет
├── comprehensive_analysis.png     # Комплексная визуализация
├── repeat_analysis.png            # Анализ повторов
├── dinucleotide_frequencies.png  # Частоты динуклеотидов
├── pca_analysis.png              # PCA проекция нулломеров
├── motif_analysis.png            # Анализ мотивов
├── network_structure.png         # Структура графа
└── nullomer_connectivity_heatmap.png  # Матрица связности

```

### Формат результатов

#### debruijn_analysis.txt
```
nullomer  classification  gc_content  pred_count  succ_count  predecessors  successors
AAAAAAAAAAAAA  isolated  0.000  0  0  none  none
AAAAAAAAAAAAC  no_successors  0.077  2  0  GAAAAAAAAAAAAC,TAAAAAAAAAAAAC  none
...
```

### Классификация нулломеров
- **isolated**: Нет ни предшественников, ни последователей
- **no_predecessors**: Есть только последователи
- **no_successors**: Есть только предшественники
- **linear**: Ровно один предшественник и один последователь
- **branching**: Множественные связи

## Примеры анализа

### Пример 1: Анализ E. coli геномов
```bash
# Скачивание геномов E. coli
mkdir ecoli_genomes
cd ecoli_genomes
# ... скачать геномы ...

# Запуск анализа
../run_nullomer_pipeline.sh -d . -k 13 -t 32 -o ecoli_results

# Визуализация
python3 ../visualize_nullomers.py ecoli_results --k 13
```

### Пример 2: Сравнительный анализ методов
```bash
# C++ метод
./run_nullomer_pipeline.sh -d genomes -m cpp -o results_cpp

# Jellyfish метод
./run_nullomer_pipeline.sh -d genomes -m jellyfish -o results_jellyfish

# Сравнение результатов
python3 compare_methods.py results_cpp results_jellyfish
```

### Пример 3: Поиск core нулломеров
```bash
# Анализ большого набора геномов
./run_nullomer_pipeline.sh -d all_bacteria -k 13 -t 64

# Поиск нулломеров, отсутствующих в 95% геномов
./bin/core_nullomer_finder nullomer_analysis_results/debruijn_analysis.txt \
    --threshold 0.95 \
    --output core_nullomers_95.txt
```

## Интерпретация результатов

### Ключевые метрики

1. **Покрытие k-мерного пространства**: Процент существующих k-меров от всех возможных
2. **Распределение классификаций**: Показывает структурные ограничения
3. **GC-содержание нулломеров**: Часто экстремальное (очень низкое или высокое)
4. **Связность в графе**: Изолированные нулломеры могут указывать на фундаментальные ограничения

### Биологическая интерпретация

- **Изолированные нулломеры**: Возможно, нарушают фундаментальные биологические ограничения
- **Нулломеры без предшественников**: Проблемы с инициацией последовательности
- **Нулломеры без последователей**: Проблемы с терминацией
- **Высокая связность**: Локальные структурные ограничения

## Производительность

### Рекомендации по оптимизации

1. **Для больших датасетов (>10,000 геномов)**:
   - Используйте C++ метод с оптимизациями
   - Выделите достаточно RAM (2-4 GB на 1000 геномов)
   - Используйте SSD для временных файлов

2. **Параллелизация**:
   - Оптимальное количество потоков: число ядер CPU
   - Для I/O интенсивных операций: threads = cores * 1.5

3. **Память**:
   - k=13: ~16 GB RAM
   - k=14: ~64 GB RAM
   - k=15: ~256 GB RAM

### Бенчмарки

| Датасет | Геномов | k | Метод | Время | RAM |
|---------|---------|---|-------|-------|-----|
| E. coli | 1,000 | 13 | C++ | 5 мин | 8 GB |
| Bacteria | 10,000 | 13 | C++ | 45 мин | 16 GB |
| Bacteria | 10,000 | 13 | Jellyfish | 2 часа | 20 GB |

## Troubleshooting

### Частые проблемы

1. **Out of Memory**
   - Уменьшите k или количество геномов
   - Используйте метод Jellyfish с дисковым кешем

2. **Segmentation fault**
   - Проверьте формат входных файлов
   - Убедитесь в достаточном количестве памяти

3. **Медленная работа**
   - Проверьте I/O производительность
   - Используйте SSD для временных файлов
   - Увеличьте количество потоков

## Публикации и ссылки

При использовании данного пайплайна, пожалуйста, ссылайтесь на:

1. Оригинальная концепция нулломеров:
   - Hampikian, G., & Andersen, T. (2007). Absent sequences: nullomers and primes. Pacific Symposium on Biocomputing.

2. Графы де Брюйна в геномике:
   - Compeau, P. E., Pevzner, P. A., & Tesler, G. (2011). How to apply de Bruijn graphs to genome assembly. Nature biotechnology.

## Лицензия

MIT License

## Контакты и поддержка

Для вопросов и предложений создавайте issues в репозитории.

## Дальнейшие планы

- [ ] Поддержка переменной длины k
- [ ] GPU ускорение для больших датасетов
- [ ] Интеграция с базами данных геномов
- [ ] Web-интерфейс для визуализации
- [ ] Поддержка других алфавитов (аминокислоты)
